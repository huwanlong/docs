(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{477:function(a,s,t){"use strict";t.r(s);var e=t(22),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[a._v("#")]),a._v(" 简介")]),a._v(" "),s("p",[a._v("lerna 是 GitHub 上面开源的一款 js 代码库管理软件， 用来对一系列相互耦合比较大、又相互独立的 js git 库进行管理。")]),a._v(" "),s("h2",{attrs:{id:"基础"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础"}},[a._v("#")]),a._v(" 基础")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" i "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-g")]),a._v(" lerna "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装")]),a._v("\nlerna init "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 一个目录下初始化")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("安装之后目录")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("packages/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 保存多包的目录")]),a._v("\npackage.json\nlerna.json\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h2",{attrs:{id:"管理模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#管理模式"}},[a._v("#")]),a._v(" 管理模式")]),a._v(" "),s("p",[a._v("使用 lerna 管理项目时，可以选择两种模式。")]),a._v(" "),s("h3",{attrs:{id:"固定模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#固定模式"}},[a._v("#")]),a._v(" 固定模式")]),a._v(" "),s("p",[a._v("默认的为固定模式(Fixed mode)，当使用 lerna init 命令初始化项目时，就默认为固定模式，也可以使用 lerna init --independent 命令初始化项目，这个时候就为独立模式(Independent mode)。\n固定模式中，packages 下的所有包共用一个版本号(version)，会自动将所有的包绑定到一个版本号上(该版本号也就是 lerna.json 中的 version 字段)，所以任意一个包发生了更新，这个共用的版本号就会发生改变。")]),a._v(" "),s("h3",{attrs:{id:"独立模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#独立模式"}},[a._v("#")]),a._v(" 独立模式")]),a._v(" "),s("p",[a._v("独立模式允许每一个包有一个独立的版本号，在使用 lerna publish 命令时，可以为每个包单独制定具体的操作，同时可以只更新某一个包的版本号。此种模式时，lerna.json 中的 version 字段指定为"),s("code",[a._v("independent")]),a._v("即可。")]),a._v(" "),s("h2",{attrs:{id:"lerna-json-解析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-json-解析"}},[a._v("#")]),a._v(" lerna.json 解析")]),a._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1.1.3"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"npmClient"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"npm"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"command"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"publish"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"ignoreChanges"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"ignored-file"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"*.md"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"bootstrap"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"ignore"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"component-*"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"npmClientArgs"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"--no-package-lock"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"packages"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"packages/*"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])]),s("ul",[s("li",[a._v("version , 当前库的版本")]),a._v(" "),s("li",[a._v("npmClient , 允许指定命令使用的 client， 默认是 npm， 可以设置成 yarn")]),a._v(" "),s("li",[a._v("command.publish.ignoreChanges ， 可以指定那些目录或者文件的变更不会被 publish")]),a._v(" "),s("li",[a._v("command.bootstrap.ignore ， 指定不受 bootstrap 命令影响的包")]),a._v(" "),s("li",[a._v("command.bootstrap.npmClientArgs ， 指定默认传给 lerna bootstrap 命令的参数")]),a._v(" "),s("li",[a._v("command.bootstrap.scope ， 指定那些包会受 lerna bootstrap 命令影响")]),a._v(" "),s("li",[a._v("packages ， 指定包所在的目录")])]),a._v(" "),s("h2",{attrs:{id:"常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[a._v("#")]),a._v(" 常用命令")]),a._v(" "),s("h3",{attrs:{id:"lerna-publish"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-publish"}},[a._v("#")]),a._v(" lerna publish")]),a._v(" "),s("p",[a._v("发布新的库版本")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("lerna publish  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 发布最新commit的修改")]),a._v("\nlerna publish "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("commit-id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 发布指定commit-id的代码")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"lerna-version"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-version"}},[a._v("#")]),a._v(" lerna version")]),a._v(" "),s("ul",[s("li",[a._v("识别出修改的包")]),a._v(" "),s("li",[a._v("创建新的版本号")]),a._v(" "),s("li",[a._v("修改 package.json")]),a._v(" "),s("li",[a._v("提交修改 打上版本的 tag")]),a._v(" "),s("li",[a._v("推送到 git 上")])]),a._v(" "),s("h3",{attrs:{id:"lerna-bootstrap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-bootstrap"}},[a._v("#")]),a._v(" lerna bootstrap")]),a._v(" "),s("ul",[s("li",[a._v("为每个包安装依赖")]),a._v(" "),s("li",[a._v("链接相互依赖的库到具体的目录")]),a._v(" "),s("li",[a._v("执行 npm run prepublish")]),a._v(" "),s("li",[a._v("执行 npm run prepare")])]),a._v(" "),s("h3",{attrs:{id:"lerna-list"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-list"}},[a._v("#")]),a._v(" lerna list")]),a._v(" "),s("p",[a._v("列举当前 lerna 库包含的包")]),a._v(" "),s("h3",{attrs:{id:"lerna-changed"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-changed"}},[a._v("#")]),a._v(" lerna changed")]),a._v(" "),s("p",[a._v("显示自上次 relase tag 以来有修改的包")]),a._v(" "),s("h3",{attrs:{id:"lerna-diff"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-diff"}},[a._v("#")]),a._v(" lerna diff")]),a._v(" "),s("p",[a._v("显示自上次 relase tag 以来有修改的包的差异， 执行 git diff")]),a._v(" "),s("h3",{attrs:{id:"lerna-exec"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-exec"}},[a._v("#")]),a._v(" lerna exec")]),a._v(" "),s("p",[a._v("在每个包目录下执行任意命令")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("lerna "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -- "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" ./node_modules "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除每个目录下的node_modules")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"lerna-run"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-run"}},[a._v("#")]),a._v(" lerna run")]),a._v(" "),s("p",[a._v("执行每个包 package.json 中的脚本命令")]),a._v(" "),s("h3",{attrs:{id:"lerna-init"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-init"}},[a._v("#")]),a._v(" lerna init")]),a._v(" "),s("p",[a._v("创建一个新的 lerna 库或者是更新 lerna 版本")]),a._v(" "),s("ul",[s("li",[a._v("修改 package.json 中 lerna 版本")]),a._v(" "),s("li",[a._v("创建 lerna.json")])]),a._v(" "),s("h3",{attrs:{id:"lerna-add"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-add"}},[a._v("#")]),a._v(" lerna add")]),a._v(" "),s("p",[a._v("添加一个包的版本为各个包的依赖")]),a._v(" "),s("h3",{attrs:{id:"lerna-clean"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-clean"}},[a._v("#")]),a._v(" lerna clean")]),a._v(" "),s("p",[a._v("删除各个包下的 node_modules")]),a._v(" "),s("h3",{attrs:{id:"lerna-import"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-import"}},[a._v("#")]),a._v(" lerna import")]),a._v(" "),s("p",[a._v("导入指定 git 仓库的包作为 lerna 管理的包")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("lerna "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("path-to-external-repository"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"lerna-link"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-link"}},[a._v("#")]),a._v(" lerna link")]),a._v(" "),s("p",[a._v("链接互相引用的库")]),a._v(" "),s("h3",{attrs:{id:"lerna-create"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-create"}},[a._v("#")]),a._v(" lerna create")]),a._v(" "),s("p",[a._v("新建包")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("lerna create "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[a._v("#")]),a._v(" 参考")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://www.jianshu.com/p/2f9c05b119c9",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.jianshu.com/p/2f9c05b119c9"),s("OutboundLink")],1)]),a._v(" "),s("p",[s("a",{attrs:{href:"https://www.jianshu.com/p/8b7e6025354b",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.jianshu.com/p/8b7e6025354b"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);